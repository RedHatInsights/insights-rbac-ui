# Auth Storage State Files

This directory contains Playwright storage state files and credential env files for E2E test authentication.

## Files

| File | Description | Usage |
|------|-------------|-------|
| `.env.v1-admin` | Credentials for V1 Admin | Loaded by `e2e:v1:auth:admin` |
| `.env.v1-userviewer` | Credentials for V1 UserViewer | Loaded by `e2e:v1:auth:userviewer` |
| `.env.v1-readonly` | Credentials for V1 ReadOnlyUser | Loaded by `e2e:v1:auth:readonly` |
| `.env.v2-admin` | Credentials for V2 Admin | Loaded by `e2e:v2:auth:admin` |
| `.env.v2-userviewer` | Credentials for V2 UserViewer | Loaded by `e2e:v2:auth:userviewer` |
| `.env.v2-readonly` | Credentials for V2 ReadOnlyUser | Loaded by `e2e:v2:auth:readonly` |
| `v1-admin.json` | Playwright session state | Generated by auth step |
| `v1-userviewer.json` | Playwright session state | Generated by auth step |
| `v1-readonly.json` | Playwright session state | Generated by auth step |
| `v2-*.json` | Playwright session state | Generated by auth step |

## Setup (One-Time)

1. Copy the template files to create your local env files:

```bash
cp e2e/auth/.env.v1-admin.template e2e/auth/.env.v1-admin
cp e2e/auth/.env.v1-userviewer.template e2e/auth/.env.v1-userviewer
cp e2e/auth/.env.v1-readonly.template e2e/auth/.env.v1-readonly
cp e2e/auth/.env.v2-admin.template e2e/auth/.env.v2-admin
cp e2e/auth/.env.v2-userviewer.template e2e/auth/.env.v2-userviewer
cp e2e/auth/.env.v2-readonly.template e2e/auth/.env.v2-readonly
```

2. Edit each `.env.*` file and fill in the credentials:

```bash
# Example: e2e/auth/.env.v1-admin
RBAC_USERNAME=your-admin@redhat.com
RBAC_PASSWORD=your-password
```

## Usage

### Local Development

All E2E scripts automatically load credentials from env files via `dotenv-cli`.
Auth is handled automatically by Playwright's setup projects - you don't need to run auth manually.

```bash
# Full lifecycle for V1 (seed + auth + test + cleanup)
TEST_PREFIX_V1=jdoe npm run e2e:v1

# Full lifecycle for V2
TEST_PREFIX_V2=jdoe npm run e2e:v2

# Full lifecycle for both V1 and V2
TEST_PREFIX_V1=jdoe-v1 TEST_PREFIX_V2=jdoe-v2 npm run e2e
```

### CI Environment

In CI, credentials are provided via environment variables instead of `.env` files:
- Konflux provides `E2E_V1_ADMIN_USERNAME`, `E2E_V1_ADMIN_PASSWORD`, etc. from Vault
- The scripts automatically map these to `RBAC_USERNAME`, `RBAC_PASSWORD` when no `.env` file exists
- No `envsubst` or manual env file creation is needed

## Persona Requirements

| Persona | SSO Role | RBAC Permissions | Notes |
|---------|----------|------------------|-------|
| Admin | Org Admin | Full access | Can do everything |
| UserViewer | Regular User | `rbac:*:read` | Read-only access to RBAC pages |
| ReadOnlyUser | Regular User | None | Only sees My User Access page |

**Note**: V1 and V2 users can be in the same org. The V2 experience is controlled by Unleash feature flags (`platform.rbac.workspaces`), not org membership.

## Notes

- `.env.*` files are gitignored (contain credentials)
- `.env.*.template` files are committed (empty templates for local setup)
- `.env.*.ci` files document the CI variable mappings (legacy, not used by scripts)
- Auth JSON files are gitignored (contain session tokens)
- Auth files expire - regenerate if tests fail with auth errors
