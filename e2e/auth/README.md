# Auth Storage State Files

This directory contains Playwright storage state files and credential env files for E2E test authentication.

## Files

| File | Description | Usage |
|------|-------------|-------|
| `.env.v1-admin` | Credentials for V1 admin | Loaded by `e2e:v1:admin` |
| `.env.v1-user` | Credentials for V1 user | Loaded by `e2e:v1:user` |
| `.env.v2-admin` | Credentials for V2 admin | Loaded by `e2e:v2:admin` |
| `.env.v2-user` | Credentials for V2 user | Loaded by `e2e:v2:user` |
| `v1-admin.json` | Playwright session state | Generated by auth step |
| `v1-user.json` | Playwright session state | Generated by auth step |
| `v2-admin.json` | Playwright session state | Generated by auth step |
| `v2-user.json` | Playwright session state | Generated by auth step |

## Setup (One-Time)

1. Copy the template files to create your local env files:

```bash
cp e2e/auth/.env.v1-admin.template e2e/auth/.env.v1-admin
cp e2e/auth/.env.v1-user.template e2e/auth/.env.v1-user
cp e2e/auth/.env.v2-admin.template e2e/auth/.env.v2-admin
cp e2e/auth/.env.v2-user.template e2e/auth/.env.v2-user
```

2. Edit each `.env.*` file and fill in the credentials:

```bash
# Example: e2e/auth/.env.v1-admin
RBAC_USERNAME=your-admin@redhat.com
RBAC_PASSWORD=your-password
```

## Usage

All E2E scripts automatically load credentials from env files via `dotenv-cli`:

```bash
# One-shot (auth + seed + test + cleanup)
TEST_PREFIX=jdoe npm run e2e:v1:admin

# Individual commands also load from env files
npm run e2e:auth:v1:admin
npm run e2e:seed:v1:admin
npm run e2e:cleanup:v1:admin
```

## User Requirements

| User Type | Org Role | Feature Flags |
|-----------|----------|---------------|
| v1-admin | Org Admin | None |
| v1-user | Regular User | None |
| v2-admin | Org Admin | `platform.rbac.workspaces` enabled in Unleash |
| v2-user | Regular User | `platform.rbac.workspaces` enabled in Unleash |

**Note**: V1 and V2 users can be in the same org. The V2 experience is controlled by Unleash feature flags, not org membership.

## Notes

- `.env.*` files are gitignored (contain credentials)
- `.env.*.template` files are committed (empty templates)
- Auth JSON files are gitignored (contain session tokens)
- Auth files expire - regenerate if tests fail with auth errors
