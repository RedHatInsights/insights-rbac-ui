import { Canvas, Meta, Story } from '@storybook/addon-docs/blocks';

<Meta title="User Journeys/Management Fabric/Workspaces (Kessel)/Documentation" />

# Kessel (Workspaces) Documentation

This documentation covers the Kessel workspace management epic, delivered incrementally across 5 milestones.

> **Note:** For the broader Management Fabric context (including Access Management), see the V2 Production stories.

## Feature Rollout

Kessel workspace management is being delivered incrementally across 5 milestones:

1. **Choose a milestone** from the sidebar (Kessel M1-M5)
2. **Select permission level** (With Write Permission or Read Only)
3. **Open the Manual Testing story** for interactive exploration
4. **Use the Controls panel** to toggle feature flags
5. **Follow the automated play functions** or explore manually

### Feature Rollout Roadmap

```
M1: Workspace List View
  â†“
M2: Hierarchy Management
  â†“
M3: RBAC Detail Pages
  â†“
M4: Role Bindings Write
  â†“
M5: Master Flag
```

---

## Feature Comparison Table

| Feature | M1 | M2 | M3 | M4 | M5 |
|---------|----|----|----|----|-----|
| **Workspace List View** | âœ… | âœ… | âœ… | âœ… | âœ… |
| **Expand/Collapse Tree** | âœ… | âœ… | âœ… | âœ… | âœ… |
| **Basic Create Workspace** | âœ… | âœ… | âœ… | âœ… | âœ… |
| **Parent Selection** | âŒ | âœ… | âœ… | âœ… | âœ… |
| **Create Subworkspace** | âŒ | âœ… | âœ… | âœ… | âœ… |
| **Edit Workspace** | âŒ | âœ… | âœ… | âœ… | âœ… |
| **Move Workspace** | âŒ | âœ… | âœ… | âœ… | âœ… |
| **Delete Workspace** | âŒ | âœ… | âœ… | âœ… | âœ… |
| **Workspace Links** | Plain Text | â†’ Inventory | â†’ RBAC | â†’ RBAC | â†’ RBAC |
| **RBAC Detail Pages** | âŒ | âŒ | âœ… | âœ… | âœ… |
| **View Role Bindings** | âŒ | âŒ | âœ… | âœ… | âœ… |
| **Modify Role Bindings** | âŒ | âŒ | âŒ | âœ… | âœ… |
| **Bulk Operations** | âŒ | âŒ | âŒ | âŒ | âœ… |

---

## Milestone Breakdown

### M1: Workspace List View
**Flag**: `platform.rbac.workspaces-list`  
**Required Permission**: `inventory:groups:write` or `inventory:groups:*`

**Features:**
- âœ… View workspaces in hierarchical tree structure
- âœ… Expand/collapse workspace tree nodes
- âœ… Basic workspace creation (parent auto-set to "Default Workspace")
- âŒ Workspace names are plain text (not clickable)
- âŒ No parent selection (disabled, fixed to Default)
- âŒ No Edit/Move/Delete operations

**User Stories:**
- [Kessel M1 With Write Permission](?path=/story/user-journeys-feature-development-workspaces-kessel-kessel-m1-workspace-list-view-with-write-permission--kessel-m1-manual-testing)
- [Kessel M1 Read Only](?path=/story/user-journeys-feature-development-workspaces-kessel-kessel-m1-workspace-list-view-read-only--kessel-m1-manual-testing)

---

### M2: Hierarchy Management
**Flags**: `platform.rbac.workspaces-list` + `platform.rbac.workspace-hierarchy`  
**Status**: ğŸš§ In development  
**Required Permission**: `inventory:groups:write` or `inventory:groups:*`

**Features:**
- âœ… All M1 features
- âœ… **Parent workspace selection** (interactive tree selector)
- âœ… **Create subworkspace** from parent's kebab menu
- âœ… **Move workspace** to different parent
- âœ… **Edit workspace** name and description
- âœ… **Delete workspace** (leaf nodes only)
- âœ… **External links**: Workspace names link to Inventory
- âŒ No RBAC workspace detail pages

**Key Change:** Workspace links now go to Inventory (`/insights/inventory/workspaces/:id`)

**User Stories:**
- [Kessel M2 With Write Permission](?path=/story/user-journeys-feature-development-workspaces-kessel-kessel-m2-hierarchy-management-with-write-permission--kessel-m2-manual-testing)

---

### M3: RBAC Detail Pages with Read-Only Role Bindings
**Flags**: M1 + M2 + `platform.rbac.workspaces-role-bindings`  
**Status**: ğŸš§ In development  
**Required Permission**: `inventory:groups:write` or `inventory:groups:*`

**Features:**
- âœ… All M1 + M2 features
- âœ… **Workspace detail pages IN RBAC** (major change!)
- âœ… **Roles tab** (default) with sub-tabs:
  - "Roles assigned in this workspace"
  - "Roles assigned in parent workspaces"
- âœ… **Assets tab** (view Inventory hosts/groups)
- âœ… **Group drawer** with Roles and Users tabs
- âœ… View role bindings (read-only)
- âŒ Cannot modify role bindings

**Key Change:** Workspace links now go to **RBAC detail pages** (`/iam/user-access/workspaces/detail/:id`) instead of Inventory!

**User Stories:**
- [Kessel M3 With Write Permission](?path=/story/user-journeys-feature-development-workspaces-kessel-kessel-m3-rbac-detail-pages-with-write-permission--kessel-m3-manual-testing)

---

### M4: Role Bindings Write Access
**Flags**: M1 + M2 + M3 + `platform.rbac.workspaces-role-bindings-write`  
**Status**: ğŸ“‹ Planned (Expected: January 2026)  
**Required Permission**: `inventory:groups:write` or `inventory:groups:*`

**Features:**
- âœ… All M1 + M2 + M3 features
- ğŸš§ **Add role binding** to workspace
- ğŸš§ **Remove role binding** from workspace
- ğŸš§ **Assign principals** (users/groups) to workspace roles
- ğŸš§ **Remove principals** from workspace roles
- ğŸš§ Full CRUD for workspace-level role assignments

**Architecture:** Introduces **workspace-scoped role bindings** (separate from organization-level roles)

**User Stories:**
- [Kessel M4 With Write Permission (Placeholder)](?path=/story/user-journeys-feature-development-workspaces-kessel-kessel-m4-role-bindings-write-with-write-permission--kessel-m4-manual-testing)

---

### M5: Master Flag (All Features)
**Flag**: `platform.rbac.workspaces` (master flag enables all)  
**Status**: ğŸ“‹ Planned  
**Required Permission**: `inventory:groups:write` or `inventory:groups:*`

**Features:**
- âœ… All M1-M4 features
- âœ… Additional bulk operations
- âœ… Complete workspace management

**Note:** This is NOT Red Hat's "M5 - Management Fabric Hosted" milestone. It's simply the state when the master flag enables all workspace features at once.

**User Stories:**
- [Kessel M5 With Write Permission](?path=/story/user-journeys-feature-development-workspaces-kessel-kessel-m5-master-flag-with-write-permission--kessel-m5-manual-testing)

---

## Testing in Storybook

Each milestone has dedicated test environments with:
- âœ… Automated verification (play functions)
- âœ… Interactive controls for feature flags and permissions
- âœ… Manual testing stories with comprehensive documentation
- âœ… MSW mock handlers for realistic API interactions

**Navigation:**
- Use the sidebar to explore different milestones
- Each milestone has "With Write Permission" and/or "Read Only" variants
- Toggle feature flags using the Controls panel
- Watch the UI update in real-time

---

## Key Concepts

### Workspace Types
- **root**: The top-level "Default Workspace"
- **standard**: Regular workspaces that can be created/edited/deleted
- **ungrouped-hosts**: Special workspace for uncategorized inventory

### Permission Gating
- **Write Access**: Requires `inventory:groups:write` or `inventory:groups:*`
- **Read-Only**: Users without write permissions can view but not modify

### Link Behavior by Milestone
- **M1**: Plain text (no links)
- **M2**: Links to Inventory (`/insights/inventory/workspaces/:id`)
- **M3+**: Links to RBAC detail pages (`/iam/user-access/workspaces/detail/:id`)

---

## Related Documentation

- [API Reference](?path=/docs/user-journeys-feature-development-workspaces-kessel-documentation-api-reference--docs)
- [useWorkspacesFlag Hook](?path=/docs/user-journeys-feature-development-workspaces-kessel-documentation-useworkspacesflag--docs)
