import { Meta } from '@storybook/addon-docs/blocks';

<Meta title="Documentation/Module Federation Guide" />

# Module Federation Guide

This guide is for Red Hat Console applications consuming RBAC UI components via module federation.

## üîå Overview

The RBAC UI application exposes components through Scalprum/frontend-components module federation. 
Consuming applications should use `AsyncComponent` from `@redhat-cloud-services/frontend-components`.

### Available Modules

| Module | Description |
|--------|-------------|
| `./modules/WorkspaceSelector` | Hierarchical workspace picker with search and automatic data fetching |
| `./modules/CreateWorkspaceWizard` | Multi-step wizard for creating workspaces |
| `./Iam` | Main IAM application entry point |

---

## üöÄ WorkspaceSelector

A self-contained workspace selector that handles data fetching, caching, and state management internally.

### Usage

```tsx
import { AsyncComponent } from '@redhat-cloud-services/frontend-components';

function MyComponent() {
  const handleWorkspaceSelect = (workspace) => {
    console.log('Selected:', workspace.workspace.id, workspace.workspace.name);
  };

  return (
    <AsyncComponent
      appName="rbac"
      module="./modules/WorkspaceSelector"
      onSelect={handleWorkspaceSelect}
      fallback={<Spinner />}
    />
  );
}
```

### Props

| Prop | Type | Description |
|------|------|-------------|
| `onSelect` | `(workspace: TreeViewWorkspaceItem) => void` | Callback when a workspace is selected |
| `initialSelectedWorkspace` | `TreeViewWorkspaceItem` | Pre-select a workspace on mount |
| `sourceWorkspace` | `TreeViewWorkspaceItem` | Exclude a workspace from the tree (for move operations) |

### Data Structure

The `onSelect` callback receives a `TreeViewWorkspaceItem`:

```typescript
interface TreeViewWorkspaceItem {
  workspace: {
    id: string;
    name: string;
    type: 'root' | 'default' | 'standard';
    parent_id?: string;
    description?: string;
  };
}
```

### Example: Move Workspace Dialog

```tsx
function MoveWorkspaceDialog({ workspaceToMove, onMove }) {
  return (
    <Modal title="Move Workspace">
      <p>Select a new parent workspace:</p>
        <AsyncComponent
          appName="rbac"
          module="./modules/WorkspaceSelector"
          sourceWorkspace={workspaceToMove}
          onSelect={(workspace) => onMove(workspace.workspace.id)}
          fallback={<Spinner />}
        />
    </Modal>
  );
}
```

---

## üßô CreateWorkspaceWizard

Multi-step wizard for creating new workspaces with validation and API integration.

### Usage

```tsx
import { AsyncComponent } from '@redhat-cloud-services/frontend-components';

function MyWorkspacesPage() {
  const [isOpen, setIsOpen] = React.useState(false);

  return (
    <>
      <Button onClick={() => setIsOpen(true)}>Create Workspace</Button>
      
      {isOpen && (
        <AsyncComponent
          appName="rbac"
          module="./modules/CreateWorkspaceWizard"
          onClose={() => setIsOpen(false)}
          onSuccess={(workspace) => {
            console.log('Created:', workspace);
            setIsOpen(false);
          }}
          fallback={<Spinner />}
        />
      )}
    </>
  );
}
```

### Props

| Prop | Type | Description |
|------|------|-------------|
| `onClose` | `() => void` | Callback when wizard is closed/cancelled |
| `onSuccess` | `(workspace) => void` | Callback when workspace is successfully created |

---

## ‚úÖ Features

All federated modules are **self-contained** and include:

- **React Query** for data fetching and caching
- **Service providers** for API clients
- **Internationalization** support
- **Error handling** and loading states

Consuming applications don't need to provide any additional context or providers.

---

## üêõ Troubleshooting

### Component Not Loading

1. Verify `@redhat-cloud-services/frontend-components` is installed
2. Check browser console for module federation errors
3. Ensure you're running in the Console platform environment

### API Errors

1. Verify user authentication
2. Check RBAC API permissions for `/api/rbac/v2/workspaces/`
3. Ensure the Console platform is properly configured

---

## üìû Support

For issues or questions:

1. Review component stories in Storybook under **Federated Modules**
2. Contact the RBAC team via Slack
3. File an issue in the RBAC UI repository

